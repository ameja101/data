filter(qc4_temp_1==TRUE)
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine",sicc))
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,FUN=sum))
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,FUN=sum,fill=NA))
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,FUN=sum,fill=NA,align="center"))
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
tail()
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,6,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE))
sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE))
q4_hobo <- sicc_data %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE))
sicc_data %>%
mutate(time=hm(dttm))
sicc_data %>%
filter(is.na(dttm))
sicc_data %>%
mutate(time=strptime(dttm,format = "%H:%M"))
sicc_data %>%
mutate(time=format(dttm,format = "%H:%M"))
sicc_data %>%
mutate(time=hm(format(dttm,format = "%H:%M")))
?as.hms
sicc_data %>%
mutate(time=as_hms())
library(hms)
sicc_data %>%
mutate(time=as_hms(dttm))
hms::hms("10:00")
?hms::hms
?betweeen
?between
dataset_id <- "10760709"
dataset_path <- glue::glue("D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\data\\hobo\\2022\\raw\\{dataset_id}.csv")
hobo_data <- read.csv(dataset_path,skip = 1,header = T) %>%
as_tibble() %>%
select(1:4)
colnames(hobo_data) <- c("id","dttm","temp","lux")
time_start <- dmy_hms("13/12/2021 00:00:00")
time_end <- dmy_hms("09/01/2022 23:00:00")
hobo_data
hobo_data %>%
mutate(dttm=dmy_hms(dttm)) %>%
filter(dttm>=time_start & dttm<=time_end)
sicc_data %>%
mutate(time=as_hms(dttm))
day_start <- "01/01/2022 06:00:00"
day_end <- "01/01/2022 17:59:59"
night_start <- "01/01/2022 18:00:00"
night_end <- "01/01/2022 05:59:59"
head(20,sicc_data)
head(sicc_data)
head(sicc_data,20)
q4_hobo <- sicc_data %>%
# mutate(time=case_when(
# 	as_hms(dttm) >= as_hms(day_start)
# 	)) %>%
# filter()
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE))
q4_hobo
sicc_data %>%
# mutate(time=case_when(
# 	as_hms(dttm) >= as_hms(day_start)
# 	)) %>%
# filter()
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc))
sicc_data %>%
# mutate(time=case_when(
# 	as_hms(dttm) >= as_hms(day_start)
# 	)) %>%
# filter()
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center"))
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_start) ~ "night"
)) %>%
head(50)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_start) ~ "night"
))
as_hms(day_start)
day_start <- dmy_hms("01/01/2022 06:00:00")
day_end <- dmy_hms("01/01/2022 17:59:59")
night_start <- dmy_hms("01/01/2022 18:00:00")
night_end <- dmy_hms("01/01/2022 05:59:59")
as_hms(day_start)
as_hms(day_end)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_start) ~ "night"
)) %>%
head(50)
sicc_data %>%
mutate(hms=as_hms(dttm))
sicc_data %>%
mutate(hms=as_hms(dttm)) %>%
mutate(test=as_hms(day_start))
sicc_data %>%
mutate(hms=as_hms(dttm)) %>%
mutate(test=as_hms(day_start)) %>%
mutate(test2=hms>test)
plot(sicc_data$dttm,sicc_data$temp)
as_hms(day_start)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end) ~ "night"
)) %>%
head(50)
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end)
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end)
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end) ~ "night"
))
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end)
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end) ~ "night"
)) %>%
head(50)
sicc_data %>%
# add_column(day_start=day_start,
# 	   day_end=day_end,
# 	   night_start=night_start,
# 	   night_end=night_end)
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end) ~ "night"
))
as_hms(sicc_data$dttm[0]) >= as_hms(day_start)
as_hms(sicc_data$dttm[0]) > as_hms(day_start)
as_hms(sicc_data$dttm[0]) == as_hms(day_start)
sicc_data %>%
# add_column(day_start=day_start,
# 	   day_end=day_end,
# 	   night_start=night_start,
# 	   night_end=night_end)
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end) ~ "night",
TRUE~"other"
))
sicc_data
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end) %>%
mutate(check=as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end))
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end) %>%
mutate(check=as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end)) %>%
select(check,dttm)
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end) %>%
mutate(check=as_hms(dttm) >= as_hms(night_start))
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end) %>%
mutate(check=as_hms(dttm) >= as_hms(night_start)) %>%
select(check,dttm)
sicc_data %>%
add_column(day_start=day_start,
day_end=day_end,
night_start=night_start,
night_end=night_end) %>%
mutate(check=as_hms(dttm) >= as_hms(night_start),
test1=as_hms(dttm),
test2=as_hms(night_start)) %>%
select(check,dttm,test1,test2)
sicc_data %>%
# add_column(day_start=day_start,
# 	   day_end=day_end,
# 	   night_start=night_start,
# 	   night_end=night_end) %>%
# mutate(check=as_hms(dttm) >= as_hms(night_start),
#        test1=as_hms(dttm),
#        test2=as_hms(night_start)) %>%
# select(check,dttm,test1,test2)
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) | as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) | as_hms(dttm) <= as_hms(night_end) ~ "night",
TRUE~"other"
))
sicc_data %>%
# add_column(day_start=day_start,
# 	   day_end=day_end,
# 	   night_start=night_start,
# 	   night_end=night_end) %>%
# mutate(check=as_hms(dttm) >= as_hms(night_start),
#        test1=as_hms(dttm),
#        test2=as_hms(night_start)) %>%
# select(check,dttm,test1,test2)
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(day_end) ~ "day",
as_hms(dttm) >= as_hms(night_start) & as_hms(dttm) <= as_hms(night_end) ~ "night",
TRUE~"other"
))
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
head(50)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) <= as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
View()
sicc_data
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day")
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
arrange(time)
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
arrange(desc(time))
sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
arrange(desc(as_hms(dttm)))
q4_hobo <- sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE))
q4_hobo
q4_hobo <- sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
select(-sicc,-time,-qc4_temp_1,-qc4_temp_2)
q4_hobo
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux"))
qc1_hobo
qc2_hobo
qc3_hobo
hobo_data_cleaned <- hobo_data %>%
mutate(dttm=dmy_hms(dttm)) %>%
filter(dttm>=time_start & dttm<=time_end) %>%
select(-id) %>%
rownames_to_column("id")
hobo_data_cleaned
qc1_hobo
hobo_data_cleaned
hobo_data_cleaned %>%
add_column(temp_min=temp_min,
temp_max=temp_max,
lux_min=lux_min,
lux_max=lux_max)
hobo_data_cleaned %>%
add_column(temp_min=temp_min,
temp_max=temp_max,
lux_min=lux_min,
lux_max=lux_max) %>%
mutate(temp_qc1=temp<temp_min & temp>temp_max,
lux_qc1=lux<lux_min & lux>lux_max)
hobo_data_cleaned %>%
add_column(temp_min=temp_min,
temp_max=temp_max,
lux_min=lux_min,
lux_max=lux_max) %>%
mutate(temp_qc1=temp<temp_min & temp>temp_max,
lux_qc1=lux<lux_min & lux>lux_max) %>%
select(-contains("min"),-contains("max"))
qc1_hobo <- hobo_data_cleaned %>%
add_column(temp_min=temp_min,
temp_max=temp_max,
lux_min=lux_min,
lux_max=lux_max) %>%
mutate(temp_qc1=temp<temp_min & temp>temp_max,
lux_qc1=lux<lux_min & lux>lux_max) %>%
select(-contains("min"),-contains("max"))
qc1_hobo
qc2_hobo <- hobo_data_cleaned %>%
mutate(qc2_temp=abs(lead(temp)-temp)>1)
qc2_hobo
qc3_hobo <- hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,5,FUN=function(x) mean(x,na.rm=T),fill=NA,align="left")) %>%
mutate(qc3_temp=roll_mean==temp) %>%
select(-roll_mean)
qc3_hobo
TRUE+1
q4_hobo <- sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
select(-sicc,-time,-qc4_temp_1,-qc4_temp_2)
q4_hobo
hobo_data_cleaned
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux"))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux"))
qc4_hobo <- sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
mutate(qc4_temp_1=grepl("sunshine",sicc),
qc4_temp_2=grepl("sunshine (bright)",sicc)) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
select(-sicc,-time,-qc4_temp_1,-qc4_temp_2)
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux"))
?coalese
?coalesce
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate(qc4_temp_flag_1=coalesce(qc4_temp_flag_1,FALSE))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate(qc4_temp_flag_1=coalesce(qc4_temp_flag_1,FALSE),
qc4_temp_flag_2=coalesce(qc4_temp_flag_2,FALSE))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate(qc4_temp_flag_1=coalesce(qc4_temp_flag_1,FALSE),
qc4_temp_flag_2=coalesce(qc4_temp_flag_2,FALSE))  %>%
View()
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate(qc4_temp_flag_1=ifelse(is.na(qc4_temp_flag_1),FALSE,qc4_temp_flag_1),
qc4_temp_flag_2=ifelse(is.na(qc4_temp_flag_2),FALSE,qc4_temp_flag_2))  %>%
View()
