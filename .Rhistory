mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
mutate_at(vars(-id,-dttm,-temp,-sicc,-time),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc4=qc4_temp_flag_1 | qc4_temp_flag_2)
select(-sicc,-time,-qc4_temp_1,-qc4_temp_2,-qc4_temp_flag_1,
-qc4_temp_flag_2)
qc4_hobo <- sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
mutate(qc4_temp_1=sicc=="sunshine",
qc4_temp_2=sicc==("sunshine (bright)")) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
mutate_at(vars(-id,-dttm,-temp,-sicc,-time),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc4=qc4_temp_flag_1 | qc4_temp_flag_2) %>%
select(-sicc,-time,-qc4_temp_1,-qc4_temp_2,-qc4_temp_flag_1,
-qc4_temp_flag_2)
qc4_hobo
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x))
qc3_hobo <- hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=function(x) mean(x,na.rm=T),
fill=NA,
align="left")) %>%
mutate(qc3=roll_mean==temp) %>%
select(-roll_mean)
sicc_data <- hobo_data_cleaned %>%
mutate(sicc=case_when(
between(lux,0,10) ~ "night",
between(lux,10,500) ~ "sunrise or sunset",
between(lux,500,2000) ~ "overcast (full)",
between(lux,2000,15000) ~ "overcast (light)",
between(lux,15000,20000) ~ "clear sky (shade)",
between(lux,20000,50000) ~ "sunshine",
between(lux,50000,Inf) ~ "sunshine (bright)"
))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x))
qc3_hobo
hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=function(x) mean(x,na.rm=T),
fill=NA,
align="left"))
hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=function(x) mean(x),
fill=NA,
align="left"))
hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=mean,
fill=NA,
align="left"))
?rollapply
hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=mean,
fill=NA,
align="right"))
hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=mean,
fill=NA,
align="right")) %>%
mutate(qc3=roll_mean==temp)
qc3_hobo <- hobo_data_cleaned %>%
mutate(roll_mean=rollapply(temp,6,
FUN=mean,
fill=NA,
align="right")) %>%
mutate(qc3=roll_mean==temp) %>%
select(-roll_mean)
sicc_data <- hobo_data_cleaned %>%
mutate(sicc=case_when(
between(lux,0,10) ~ "night",
between(lux,10,500) ~ "sunrise or sunset",
between(lux,500,2000) ~ "overcast (full)",
between(lux,2000,15000) ~ "overcast (light)",
between(lux,15000,20000) ~ "clear sky (shade)",
between(lux,20000,50000) ~ "sunshine",
between(lux,50000,Inf) ~ "sunshine (bright)"
))
day_start <- dmy_hms("01/01/2022 06:00:00")
day_end <- dmy_hms("01/01/2022 17:59:59")
night_start <- dmy_hms("01/01/2022 18:00:00")
night_end <- dmy_hms("01/01/2022 05:59:59")
qc4_hobo <- sicc_data %>%
mutate(time=case_when(
as_hms(dttm) >= as_hms(day_start) & as_hms(dttm) < as_hms(night_start) ~ "day",
TRUE ~ "night"
)) %>%
filter(time=="day") %>%
mutate(qc4_temp_1=sicc=="sunshine",
qc4_temp_2=sicc==("sunshine (bright)")) %>%
mutate(qc4_temp_flag_1=rollapply(qc4_temp_1,3,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_2=rollapply(qc4_temp_2,7,
FUN=sum,
fill=NA,
align="center")) %>%
mutate(qc4_temp_flag_1=ifelse(qc4_temp_flag_1>0,TRUE,FALSE),
qc4_temp_flag_2=ifelse(qc4_temp_flag_2>0,TRUE,FALSE)) %>%
mutate_at(vars(-id,-dttm,-temp,-sicc,-time),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc4=qc4_temp_flag_1 | qc4_temp_flag_2) %>%
select(-sicc,-time,-qc4_temp_1,-qc4_temp_2,-qc4_temp_flag_1,
-qc4_temp_flag_2)
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4)
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>1,1,0))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot > 1, "bad", "good"))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4)
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good"))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(hour_dttm=ymd_h(dttm))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(hour_dttm=ymd_h(format(dttm,format="%Y-%M-%d %H")))
dttm <- hobo_data_cleaned$dttm[1]
dttm
format(dttm,format="%Y-%M-%d %H")
format(dttm,format="%Y-%m-%d %H")
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(hour_dttm=ymd_h(format(dttm,format="%Y-%m-%d %H")))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(hour_dttm=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(hour_dttm) %>%
summarize(th=mean(temp))
?group_by
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(hour_dttm=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(hour_dttm,.drop=F) %>%
summarize(th=mean(temp))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H")))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th)) %>%
select(-flag_mean)
hourly_data <- hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th)) %>%
select(-flag_mean)
hourly_data
hourly_data %>%
filter(is.na(th))
hourly_data %>%
ggplot(aes(date_time,th))+
geom_line()
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H")))
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
filter(qc_tot>0) %>%
View()
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good")) %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
filter(qc_tot>0) %>%
count(qc1,qc2,qc3,qc4)
hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
filter(qc2==TRUE)
flagged_data <- hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good"))
hourly_data <- flagged_data %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th)) %>%
select(-flag_mean)
flagged_data
hourly_data <- flagged_data %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th)) %>%
select(-flag_mean)
flagged_data
flagged_data <- hobo_data_cleaned %>%
left_join(qc1_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc2_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc3_hobo,by=c("id","dttm","temp","lux")) %>%
left_join(qc4_hobo,by=c("id","dttm","temp","lux")) %>%
mutate_at(vars(-id,-dttm,-temp,-lux),function(x) ifelse(is.na(x),
FALSE,
x)) %>%
mutate(qc_tot=qc1+qc2+qc3+qc4) %>%
mutate(flag_num=ifelse(qc_tot>=1,1,0)) %>%
mutate(flag_txt =ifelse(qc_tot>=1,"bad","good"))
hourly_data <- hobo_data_cleaned %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th)) %>%
select(-flag_mean)
flagged_data
hourly_data <- flagged_data %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th)) %>%
select(-flag_mean)
hourly_data
apply(hourly_data,2,function(x) is.na(x))
apply(hourly_data,1,function(x) is.na(x))
apply(hourly_data,2,function(x) sum(is.na(x)))
apply(flagged_data,2,function(x) sum(is.na(x)))
apply(flagged_data,2,function(x) sum(x))
select(flagged_data,contains("qc"))
select(flagged_data,contains("qc"),-qc_tot)
apply(select(flagged_data,contains("qc"),-qc_tot),2,function(x) sum(x))
flagged_data %>%
filter(qc3==FALSE)
flagged_data %>%
filter(qc3==TRUE)
hourly_data %>%
ggplot(aes(date_time,th))+
geom_line()
flagged_data %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th))
flagged_data %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th),
type=ifelse(flag_mean>0,"bad","good"))
flagged_data %>%
mutate(date_time=ymd_h(format(dttm,format="%Y-%m-%d %H"))) %>%
group_by(date_time) %>%
summarize(th=mean(temp),flag_mean=mean(qc_tot)) %>%
mutate(th=ifelse(flag_mean>0,NA,th),
type=ifelse(flag_mean>0,"bad","good")) %>%
ggplot(aes(date_time,th,col=type))+
geom_line()
hourly_data %>%
ggplot(aes(date_time,th))+
geom_line()
hobo_data_cleaned
tail(hobo_data_cleaned)
hobo_data_cleaned <- hobo_data %>%
mutate(dttm=dmy_hms(dttm)) %>%
filter(dttm>=time_start & dttm<=time_end) %>%
select(-id) %>%
rownames_to_column("id")
hobo_data_cleaned
tail(hobo_data_cleaned)
write.csv(hobo_data_cleaned,
"D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\exercise_output\\exercise_1.csv",
row.names = F)
write.csv(hobo_data_cleaned,
glue::glue("D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\data\\hobo\\2022\\10_minute\\{dataset_id}.csv"),
row.names = F)
read.csv(glue::glue("D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\data\\hobo\\2022\\10_minute\\{dataset_id}.csv"))
read.csv(glue::glue("D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\data\\hobo\\2022\\10_minute\\{dataset_id}.csv"),row.names = F)
read.csv(glue::glue("D:\\Environmental Modelling\\1_Semester\\Data_Collection\\R\\data\\hobo\\2022\\10_minute\\10234637.csv"))
